<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketing Channel Expense Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="bg-white rounded-lg shadow-xl p-8 max-w-6xl w-full">
    <div class="flex justify-between items-center mb-6 border-b pb-4">
      <h1 class="text-3xl font-bold text-gray-800">Marketing Channel Expense Dashboard</h1>
      <span class="text-sm text-gray-500">Last Updated: <span id="last-updated"></span></span>
    </div>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="flex flex-col">
        <label for="chart-type" class="mb-2 text-sm font-medium text-gray-700">Monthly Spend Chart Type</label>
        <select id="chart-type" class="filter-select">
          <option value="bar">Bar Chart</option>
          <option value="line">Line Chart</option>
          <option value="pie">Pie Chart</option>
        </select>
      </div>
      <div class="flex flex-col">
        <label for="investment-chart-type" class="mb-2 text-sm font-medium text-gray-700">Investment Chart Type</label>
        <select id="investment-chart-type" class="filter-select">
          <option value="bar">Bar Chart</option>
          <option value="pie">Pie Chart</option>
        </select>
      </div>
      <div class="flex flex-col">
        <label for="csv-upload" class="mb-2 text-sm font-medium text-gray-700">Upload CSV</label>
        <input type="file" id="csv-upload" accept=".csv" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none" />
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg p-6 shadow-inner mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Spend by Channel</h2>
      <div style="height: 400px;">
        <canvas id="marketing-chart" style="max-height: 100%; max-width: 100%;"></canvas>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg p-6 shadow-inner mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Marketing Channel Investment Overview</h2>
      <div style="height: 400px;">
        <canvas id="investment-chart" style="max-height: 100%; max-width: 100%;"></canvas>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg p-6 shadow-inner">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Raw Expense Data</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Channel</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Month</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Spend ($)</th>
            </tr>
          </thead>
          <tbody id="expense-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let marketingData = [];
    let chartInstance;
    let investmentChart;

    const chartTypeSelect = document.getElementById('chart-type');
    const investmentChartTypeSelect = document.getElementById('investment-chart-type');

    function updateChart(data) {
      const ctx = document.getElementById('marketing-chart').getContext('2d');
      if (chartInstance) chartInstance.destroy();

      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const channels = [...new Set(data.map(d => d.channel))];
      const chartType = chartTypeSelect.value;

      const colors = {
        'Social Media Ads': '#3b82f6',
        'Content Marketing': '#22c55e',
        'Email Marketing': '#f97316',
        'Other': '#888888'
      };

      const datasets = channels.map(channel => ({
        label: channel,
        backgroundColor: colors[channel] || colors['Other'],
        borderColor: colors[channel] || colors['Other'],
        fill: chartType !== 'line',
        data: months.map(month =>
          data.filter(d => d.channel === channel && d.month === month)
              .reduce((sum, d) => sum + Number(d.spend), 0)
        )
      }));

      const pieData = {
        labels: channels,
        datasets: [{
          data: channels.map(channel =>
            data.filter(d => d.channel === channel)
                .reduce((sum, d) => sum + Number(d.spend), 0)
          ),
          backgroundColor: channels.map(c => colors[c] || colors['Other'])
        }]
      };

      chartInstance = new Chart(ctx, {
        type: chartType,
        data: chartType === 'pie' ? pieData : { labels: months, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { position: 'top' } },
          scales: chartType === 'pie' ? {} : {
            x: { title: { display: true, text: 'Month' } },
            y: { title: { display: true, text: 'Spend ($)' } }
          }
        }
      });
    }

    function renderInvestmentChart(data) {
      const ctx = document.getElementById('investment-chart').getContext('2d');
      if (investmentChart) investmentChart.destroy();

      const chartType = investmentChartTypeSelect.value;
      const channelTotals = {};
      data.forEach(d => {
        channelTotals[d.channel] = (channelTotals[d.channel] || 0) + d.spend;
      });

      const labels = Object.keys(channelTotals);
      const values = Object.values(channelTotals);
      const backgroundColors = labels.map(c => ({
        'Social Media Ads': '#3b82f6',
        'Content Marketing': '#22c55e',
        'Email Marketing': '#f97316'
      }[c] || '#888888'));

      const chartData = {
        labels: labels,
        datasets: [{
          label: 'Total Investment ($)',
          data: values,
          backgroundColor: backgroundColors
        }]
      };

      const chartOptions = {
        responsive: true,
        plugins: {
          legend: chartType === 'pie' ? { position: 'top' } : { display: false },
          title: { display: true, text: 'Total Investment by Marketing Channel' }
        },
        scales: chartType === 'pie' ? {} : {
          y: {
            title: { display: true, text: 'Spend ($)' },
            beginAtZero: true
          }
        }
      };

      investmentChart = new Chart(ctx, {
        type: chartType,
        data: chartData,
        options: chartOptions
      });
    }

    function updateTable(data) {
      const tableBody = document.getElementById('expense-table-body');
      tableBody.innerHTML = '';
      data.forEach(d => {
        tableBody.innerHTML += `
          <tr>
            <td class="px-6 py-4">${d.channel}</td>
            <td class="px-6 py-4">${d.month}</td>
            <td class="px-6 py-4">$${d.spend}</td>
          </tr>`;
      });
    }

    document.getElementById('csv-upload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          marketingData = results.data.map(row => ({
            channel: row.channel || row.Channel,
            month: row.month || row.Month,
            spend: parseFloat(row.spend || row.Spend || 0)
          }));
          updateChart(marketingData);
          renderInvestmentChart(marketingData);
          updateTable(marketingData);
        }
      });
    });

    chartTypeSelect.addEventListener('change', () => {
      updateChart(marketingData);
    });

    investmentChartTypeSelect.addEventListener('change', () => {
      renderInvestmentChart(marketingData);
    });

    window.onload = () => {
      document.getElementById('last-updated').textContent = new Date().toLocaleDateString();
    };
  </script>
</body>
</html>
